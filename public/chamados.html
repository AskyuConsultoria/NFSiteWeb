<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Solicitações de Serviço</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container mt-5">
      <h3 class="text-center mb-4">Solicitações do HelpDask</h3>
      <div id="cardsContainer"></div>
    </div>

    <script>
      async function carregarSolicitacoes() {
        try {
          const resposta = await fetch("http://localhost:8080/syntro/solicitacoes");
          const solicitacoes = await resposta.json();

          const container = document.getElementById("cardsContainer");
          container.innerHTML = "";

          solicitacoes.forEach(solicitacao => {
            const card = document.createElement("div");
            card.className = "card mb-3";
            card.innerHTML = `
              <div class="card-body">
                <p><strong>ID da SS:</strong> <span class="ss-id">${solicitacao.idSS}</span></p>
                <p><strong>ID da Nota Fiscal:</strong> <span>${solicitacao.idNotaFiscal}</span></p>
                <p><strong>ID do Card Pipefy:</strong> <span>${solicitacao.idCardPipefy}</span></p>
                <p><strong>E-mail do Usuário:</strong> <span>${solicitacao.emailUsuario}</span></p>
                <p><strong>Tipo de Operação:</strong> <span>${solicitacao.operacao}</span></p>
                <p><strong>Justificativa:</strong> <span>${solicitacao.justificativa}</span></p>
                <div class="d-flex justify-content-end gap-2 mt-3">
                  <button class="btn btn-success" onclick="aceitarSolicitacao('${solicitacao.idSS}', this)">Aceitar</button>
                  <button class="btn btn-danger" onclick="cancelarSolicitacao('${solicitacao.idSS}')">Cancelar</button>
                </div>
              </div>
            `;
            container.appendChild(card);
          });

        } catch (erro) {
          alert("Erro ao carregar solicitações.");
        }
      }

      async function cancelarSolicitacao(id, botao) {
        try {
          const resposta = await fetch(`http://localhost:8080/syntro/solicitacoes/${id}`, {
            method: 'DELETE'
          });

          if (resposta.ok) {
            alert(`Solicitação ${id} aceita.`);
            botao.closest(".card").remove();
          } else {
            alert("Erro ao aceitar solicitação.");
          }
        } catch {
          alert("Erro de conexão com o backend.");
        }
      }

      function aceitarSolicitacao(id) {
        alert(`Solicitação ${id} aceita.`);
      }

      carregarSolicitacoes();
    </script>
  </body>
</html>
